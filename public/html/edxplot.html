<!DOCTYPE html>
<html>
    <head>
		<script type= "text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
		<style>
			input{
				width: 60px;
			}
			label {
				display: inline-block;
				width: 50px;
				text-align: right;
			}
			h1 {
				text-align: center;
			}
		</style>
    </head>
    <body>
		<h1>Intensity function</h1>
		$$I = f(E)$$
		<table>
			<tr>
				<td>
					<div title='Minimum energy (eV)'>
						<label for="xmin" style='font-size:smaller'>Min E:</label>
						<input type="number" id="xmin" style="color:black" value="0" step="1000" min="0"/>
					</div>
					<div title='Maximum energy (eV)'>
						<label for="xmax" style='font-size:smaller'>Max E:</label>
						<input type="number" id="xmax" style="color:black" value="8000" step="1000" min="1000"/>
					</div>
					<div title='Minimum intensity'>
						<label for="ymin" style='font-size:smaller'>Min I:</label>
						<input type="number" id="ymin" style="color:black" value="0" step="1000" min="0"/>
					</div>
					<div title='Maximum intensity'>
						<label for="ymax" style='font-size:smaller'>Max I:</label>
						<input type="number" id="ymax" style="color:black" value="22000" step="1000" min="1000"/>
					</div>
				</td>
				<td>
					<div id="plot"></div>
				</td>
			</tr>
		</table>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/4.1.2/math.min.js"></script>		
        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/function-plot/1.18.1/function-plot.js"></script>
		<script>
			// See https://mauriciopoppe.github.io/function-plot/ for documentation and examples
			let Z = '14';
			let A = '(e ^ (-0.223 * x / (0.2998 * ' + Z + ' ^ 2)) - e ^ (-57 * x / (0.2998 * ' + Z + ' ^ 2)))';
			let B = '(e ^ (-0.0828 * x / (0.2998 * ' + Z + ' ^ 2)) - e ^ (-84.9 * x / (0.2998 * ' + Z + ' ^ 2)))';
			let a = '(1.47 * ' + B + ' - 0.507 * ' + A + ' - 0.833)';
			let b = '(1.70 * ' + B + ' - 1.09 * ' + A + ' - 0.627)';
			let backgroundFunction = '0.2998 * ' + Z + ' ^ 2 / x * abs(0.252 + ' + a + ' * (1 - 0.135) - ' + b + ' * (1 - 0.135) ^ 2) * 1.51 * 10 ^ -24'
			function drawLine() {
				try {
					functionPlot({
						target: '#plot',
						width: 834,
						tip: {
							xLine: true,
							yLine: true,
							renderer: function (x, y, index) {
								// the returning value will be shown in the tip
								return 'E: ' + x.toFixed(0) + ', I: ' + y.toFixed(0);
							}
						},
						xAxis: {
							label: 'Energy',
							domain: [Number(document.getElementById('xmin').value), Number(document.getElementById('xmax').value)]
						},
						yAxis: {
							label: 'Intensity',
							domain: [Number(document.getElementById('ymin').value), Number(document.getElementById('ymax').value)]
						},
						grid: true,
						data: [{
							fn: backgroundFunction,
							sampler: 'builtIn',  // this will make function-plot use the evaluator of math.js
							graphType: 'polyline',
							closed: true
						}]
					});
				}
				catch (err) {
					console.log(err);
				}
			}
			
			// .onclick detects changes to a number input field with the arrows on the side
			document.getElementById('xmin').onclick = function (event) {
				event.preventDefault();
				drawLine();
			};

			// .onkeyup gives immediate feedback to changes as the user enters numbers with the keyboard
			document.getElementById('xmin').onkeyup = function (event) {
				event.preventDefault();
				drawLine();
			};

			document.getElementById('xmax').onclick = function (event) {
				event.preventDefault();
				drawLine();
			};

			document.getElementById('xmax').onkeyup = function (event) {
				event.preventDefault();
				drawLine();
			};
			
			document.getElementById('ymin').onclick = function (event) {
				event.preventDefault();
				drawLine();
			};

			document.getElementById('ymin').onkeyup = function (event) {
				event.preventDefault();
				drawLine();
			};
			
			document.getElementById('ymax').onclick = function (event) {
				event.preventDefault();
				drawLine();
			};

			document.getElementById('ymax').onkeyup = function (event) {
				event.preventDefault();
				drawLine();
			};

			window.addEventListener('resize', function ( event ) { 
				event.preventDefault();
				drawLine();
			});

			drawLine();
		</script>
    </body>
</html>